# .woodpecker.yml
steps:
  deploy:
    image: alpine:3.20
    environment:
      DOCKER_HOST: unix:///var/run/docker.sock
      PROJECT_PATH: /srv/personal-website
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /home/ego/app/personal-website:/srv/personal-website
    commands:
      - echo "Deploying personal-website on indraswara.me"
      - cd $PROJECT_PATH
      - git pull origin main
      - docker compose pull
      - docker compose up -d --remove-orphans
      - docker system prune -f
    when:
      branch: main
